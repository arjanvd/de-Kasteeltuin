!function(o){o.isScrollToFixed=function(i){return!!o(i).data("ScrollToFixed")},o.ScrollToFixed=function(i,e){function t(){S.trigger("preUnfixed.ScrollToFixed"),p(),S.trigger("unfixed.ScrollToFixed"),y=-1,v=S.offset().top,C=S.offset().left,F.options.offsets&&(C+=S.offset().left-S.position().left),-1==U&&(U=C),m=S.css("position"),T=!0,-1!=F.options.bottom&&(S.trigger("preFixed.ScrollToFixed"),d(),S.trigger("fixed.ScrollToFixed"))}function n(){var o=F.options.limit;return o?"function"==typeof o?o.apply(S):o:0}function l(){return"fixed"===m}function r(){return"absolute"===m}function s(){return!(l()||r())}function d(){l()||(z.css({display:S.css("display"),width:S.outerWidth(!0),height:S.outerHeight(!0),"float":S.css("float")}),cssOptions={"z-index":F.options.zIndex,position:"fixed",top:-1==F.options.bottom?f():"",bottom:-1==F.options.bottom?"":F.options.bottom,"margin-left":"0px"},F.options.dontSetWidth||(cssOptions.width=S.width()),S.css(cssOptions),S.addClass(F.options.baseClassName),F.options.className&&S.addClass(F.options.className),m="fixed")}function c(){var o=n(),i=C;F.options.removeOffsets&&(i="",o-=v),cssOptions={position:"absolute",top:o,left:i,"margin-left":"0px",bottom:""},F.options.dontSetWidth||(cssOptions.width=S.width()),S.css(cssOptions),m="absolute"}function p(){s()||(y=-1,z.css("display","none"),S.css({"z-index":w,width:"",position:b,left:"",top:h,"margin-left":""}),S.removeClass("scroll-to-fixed-fixed"),F.options.className&&S.removeClass(F.options.className),m=null)}function x(o){o!=y&&(S.css("left",C-o),y=o)}function f(){var o=F.options.marginTop;return o?"function"==typeof o?o.apply(S):o:0}function u(){if(o.isScrollToFixed(S)){var i=T;T?s()&&(v=S.offset().top,C=S.offset().left):t();var e=o(window).scrollLeft(),u=o(window).scrollTop(),m=n();F.options.minWidth&&o(window).width()<F.options.minWidth?s()&&i||(g(),S.trigger("preUnfixed.ScrollToFixed"),p(),S.trigger("unfixed.ScrollToFixed")):F.options.maxWidth&&o(window).width()>F.options.maxWidth?s()&&i||(g(),S.trigger("preUnfixed.ScrollToFixed"),p(),S.trigger("unfixed.ScrollToFixed")):-1==F.options.bottom?m>0&&u>=m-f()?r()&&i||(g(),S.trigger("preAbsolute.ScrollToFixed"),c(),S.trigger("unfixed.ScrollToFixed")):u>=v-f()?(l()&&i||(g(),S.trigger("preFixed.ScrollToFixed"),d(),y=-1,S.trigger("fixed.ScrollToFixed")),x(e)):s()&&i||(g(),S.trigger("preUnfixed.ScrollToFixed"),p(),S.trigger("unfixed.ScrollToFixed")):m>0?u+o(window).height()-S.outerHeight(!0)>=m-(f()||-a())?l()&&(g(),S.trigger("preUnfixed.ScrollToFixed"),"absolute"===b?c():p(),S.trigger("unfixed.ScrollToFixed")):(l()||(g(),S.trigger("preFixed.ScrollToFixed"),d()),x(e),S.trigger("fixed.ScrollToFixed")):x(e)}}function a(){return F.options.bottom?F.options.bottom:0}function g(){var o=S.css("position");"absolute"==o?S.trigger("postAbsolute.ScrollToFixed"):"fixed"==o?S.trigger("postFixed.ScrollToFixed"):S.trigger("postUnfixed.ScrollToFixed")}var F=this;F.$el=o(i),F.el=i,F.$el.data("ScrollToFixed",F);var T=!1,S=F.$el,m,b,h,w,v=0,C=0,U=-1,y=-1,z=null,A,O,W=function(o){S.is(":visible")&&(T=!1,u())},N=function(o){window.requestAnimationFrame?requestAnimationFrame(u):u()},D=function(){var o=document.body;if(document.createElement&&o&&o.appendChild&&o.removeChild){var i=document.createElement("div");if(!i.getBoundingClientRect)return null;i.innerHTML="x",i.style.cssText="position:fixed;top:100px;",o.appendChild(i);var e=o.style.height,t=o.scrollTop;o.style.height="3000px",o.scrollTop=500;var n=i.getBoundingClientRect().top;o.style.height=e;var l=100===n;return o.removeChild(i),o.scrollTop=t,l}return null},H=function(o){o=o||window.event,o.preventDefault&&o.preventDefault(),o.returnValue=!1};F.init=function(){F.options=o.extend({},o.ScrollToFixed.defaultOptions,e),w=S.css("z-index"),F.$el.css("z-index",F.options.zIndex),z=o("<div />"),m=S.css("position"),b=S.css("position"),h=S.css("top"),s()&&F.$el.after(z),o(window).bind("resize.ScrollToFixed",W),o(window).bind("scroll.ScrollToFixed",N),"ontouchmove"in window&&o(window).bind("touchmove.ScrollToFixed",u),F.options.preFixed&&S.bind("preFixed.ScrollToFixed",F.options.preFixed),F.options.postFixed&&S.bind("postFixed.ScrollToFixed",F.options.postFixed),F.options.preUnfixed&&S.bind("preUnfixed.ScrollToFixed",F.options.preUnfixed),F.options.postUnfixed&&S.bind("postUnfixed.ScrollToFixed",F.options.postUnfixed),F.options.preAbsolute&&S.bind("preAbsolute.ScrollToFixed",F.options.preAbsolute),F.options.postAbsolute&&S.bind("postAbsolute.ScrollToFixed",F.options.postAbsolute),F.options.fixed&&S.bind("fixed.ScrollToFixed",F.options.fixed),F.options.unfixed&&S.bind("unfixed.ScrollToFixed",F.options.unfixed),F.options.spacerClass&&z.addClass(F.options.spacerClass),S.bind("resize.ScrollToFixed",function(){z.height(S.height())}),S.bind("scroll.ScrollToFixed",function(){S.trigger("preUnfixed.ScrollToFixed"),p(),S.trigger("unfixed.ScrollToFixed"),u()}),S.bind("detach.ScrollToFixed",function(i){H(i),S.trigger("preUnfixed.ScrollToFixed"),p(),S.trigger("unfixed.ScrollToFixed"),o(window).unbind("resize.ScrollToFixed",W),o(window).unbind("scroll.ScrollToFixed",N),S.unbind(".ScrollToFixed"),z.remove(),F.$el.removeData("ScrollToFixed")}),W()},F.init()},o.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1e3,baseClassName:"scroll-to-fixed-fixed"},o.fn.scrollToFixed=function(i){return this.each(function(){new o.ScrollToFixed(this,i)})}}(jQuery);